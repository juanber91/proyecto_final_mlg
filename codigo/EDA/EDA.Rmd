---
title: "EDA_PROY_FIN"
author: "Alejandro Nivón Ruiz"
date: "December 15, 2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE, root.dir = "~/Documentos/RgrAvn/ProyectoFinal/proyecto_final_mlg")
```

## BASES DE DATOS

Para el análisis explortatorio de datos se incorporará la información poblacional por estado y municipio de los años que estudia la base.

Los censos poblacionales se llevan a cabo cada 10 años y los conteos intercensales 5 años después de cada censo, por lo que se tienen estimaciones poblacionales por municipio para los años 2005 y 2010. 
Para estimar la población interanual hasta el año 2011 se realizó una estimación lineal anual tomando en cuenta como puntos extremos ambos conteos censales.

El fin de contar con las estimaciones anuales será el de poder estandarizar los conteos de ejecuciones por densidad poblacional y de esta forma poder hacer comparable la información de estado a estado o de municipio a municipio y así tener una percepción mejor del nivel de riesgo que conlleva cada sector geográfico.


```{r cars, echo=FALSE}
setwd("~/Documentos/RgrAvn/ProyectoFinal/proyecto_final_mlg")
pob <- read.csv("datos/Proyeccion de Poblacion/Población por Municipio 2005 - 2011.csv")
pob %<>% 
  select(ESTADO = cve_ent, estado = nom_ent, cve_mun, contains('pob_ent')) %>% 
  mutate(ESTADO = as.character(ESTADO)) %>% 
  gather(AÑO, poblacion, contains('pob_ent')) %>% 
  mutate(AÑO = parse_number(str_remove(AÑO, '\\.'))) %>% 
  group_by(ESTADO, estado, AÑO) %>% 
  summarise(poblacion = sum(poblacion)) %>% 
  ungroup()

narco <- read.csv('datos/limpios.csv')

narco_mensual <- narco %>%
  filter(AÑO != 2006) %>% 
  group_by(ESTADO, AÑO, MES) %>% 
  summarise_at(vars(EJF:cartel_otro), ~sum(., na.rm = T)) %>% 
  ungroup() %>% 
  mutate(ESTADO = as.character(ESTADO))
```

## Including Plots

```{r pressure, echo=FALSE}
hist1 <- narco_mensual %>% select(ESTADO, AÑO, EJ) %>% group_by(AÑO, ESTADO) %>%
  summarise(EJ = sum(EJ)) %>% merge(pob, by = c("ESTADO", "AÑO"))
hist1 <- hist1 %>% transform(AÑO = as.integer(AÑO))
ggplot(hist1, aes(x = log(poblacion), y = log(EJ), color = AÑO)) + geom_point() + ggtitle("Relación Población vs Ejecuciones por estado 2007 - 2011") + theme(plot.title = element_text(hjust = 0.5)) +  stat_smooth(method="lm", formula = y ~ x + I(x^2), alpha = 0.2, size = 0.5, color = "gray30")
```
  
Se puede notar aquí que los estados con mayor población tienden a tener una mayor cantidad de ejecuciones, por lo que la variable a analizar será la tasas de ejecuciones por cada millón de habitantes por estado.

```{r, echo=FALSE}
hist2 <- hist1 %>% mutate(tasa = EJ/poblacion*1000000)
ggplot(hist2, aes(x = log(poblacion), y = log(tasa), color = AÑO)) + geom_point() + ggtitle("Relación Población vs tasa de ejecuciones por cada millón de habitantes por estado 2007 - 2011") + theme(plot.title = element_text(hjust = 0.5)) + theme(plot.title = element_text(size = 10)) +  stat_smooth(method="lm", formula = y ~ x + I(x^2), alpha = 0.2, size = 0.5, color = "gray30")
```

No hay una relación tan clara entre el tamaño de la población estatal y la tendencia en las tasas de ejecuciones por cada millón de habitantes.
Por lo que se decidió que est avariable sea la que se modelará.

